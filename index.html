<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThreatForge</title>
    <style>
        body { margin: 0; }
        canvas { display: block; }
        #threat-info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            display: none;
            font-family: sans-serif;
        }
    #player-panel {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-family: sans-serif;
        width: 200px;
    }
    #player-panel h3 {
        margin-top: 0;
        text-align: center;
    }
    #investigate-button {
        width: 100%;
        padding: 8px;
        margin-top: 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
    }
    #investigate-button:hover {
        background-color: #0056b3;
    }
    #mitigate-button {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        background-color: #28a745; /* Green */
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
    }
    #mitigate-button:hover {
        background-color: #218838;
    }
    #weather-panel {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-family: sans-serif;
        width: 200px;
        display: none; /* Initially hidden */
    }
    #weather-panel h3 {
        margin-top: 0;
        text-align: center;
    }
    #narrative-log {
        position: absolute;
        bottom: 10px;
        right: 10px;
        width: 300px;
        height: 200px;
        background: rgba(0, 0, 0, 0.7);
        color: #00ff00; /* Green text for a terminal look */
        padding: 10px;
        border-radius: 5px;
        font-family: 'Courier New', Courier, monospace;
        font-size: 12px;
        overflow-y: scroll;
        border: 1px solid #00ff00;
    }
    .narrative-entry {
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 1px dashed #00ff00;
    }
    .narrative-entry h4 {
        margin: 0 0 5px 0;
        color: #ffffff;
    }
    .narrative-entry p {
        margin: 0;
    }
    #goals-panel {
        position: absolute;
        bottom: 220px; /* Positioned above the narrative log */
        right: 10px;
        width: 300px;
        height: 150px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-family: sans-serif;
        overflow-y: scroll;
        border: 1px solid #00aaff;
    }
    #goals-panel h3 {
        margin-top: 0;
        color: #00aaff;
    }
    .goal-entry {
        margin-bottom: 10px;
    }
    .goal-progress-bar {
        width: 100%;
        background-color: #555;
        border-radius: 3px;
        overflow: hidden;
    }
    .goal-progress {
        width: 0%;
        height: 10px;
        background-color: #00aaff;
    }
    </style>
</head>
<body>
    <div id="goals-panel"></div>
    <div id="threat-info"></div>
    <div id="agent-panel" style="position: absolute; top: 250px; right: 10px; background: rgba(0, 0, 0, 0.7); color: white; padding: 10px; border-radius: 5px; font-family: sans-serif; width: 200px;">
        <h3>Agent Command</h3>
        <button id="recruit-agent-button" style="width: 100%;" title="Recruit a new covert agent. Requires a friendly region to be selected.">Recruit Agent (1500F, 500I)</button>
        <ul id="agent-list" style="list-style: none; padding: 0; margin-top: 10px; max-height: 150px; overflow-y: auto;">
            <!-- Agent statuses will be populated here by main.js -->
        </ul>
    </div>
    <div id="player-panel">
        <div style="padding-bottom: 10px; border-bottom: 1px solid #555; margin-bottom: 10px;">
            <input type="checkbox" id="casual-mode-checkbox" checked>
            <label for="casual-mode-checkbox">Casual Mode</label>
        </div>
        <h3 id="faction-name">Faction Name</h3>
        <div id="resource-display">
            <p><strong>Funds:</strong> <span id="funds-value">0</span></p>
            <p><strong>Intel:</strong> <span id="intel-value">0</span></p>
            <p><strong>Tech:</strong> <span id="tech-value">0</span></p>
        </div>
        <button id="toggle-plumes-button" style="width: 100%; margin-top: 10px;" title="Toggle visibility of radiological plumes">Toggle Plumes</button>
        <button id="claim-region-button" style="width: 100%; margin-top: 5px;" title="Claim the region of the selected threat" disabled>Claim Region</button>
        <button id="deploy-network-button" style="width: 100%; margin-top: 5px;" title="Deploy network infrastructure in the selected region" disabled>Deploy Network (800F, 400T)</button>
        <div id="ai-alert-level" style="width: 100%; margin-top: 10px; text-align: center; font-weight: bold;">AI Alert: LOW</div>
        <button id="build-button" style="width: 100%; margin-top: 5px;" disabled>Build</button>
        <button id="move-agent-button" style="width: 100%; margin-top: 5px;" disabled>Move Agent</button>
        <button id="research-button" style="width: 100%; margin-top: 5px;">Research</button>
        <button id="launch-satellite-button" style="width: 100%; margin-top: 5px;">Launch Satellite (2.5k F, 5k T)</button>
    </div>
    <div id="weather-panel">
        <h3>Weather</h3>
        <p><strong>Type:</strong> <span id="weather-type">--</span></p>
        <p><strong>Wind Speed:</strong> <span id="weather-wind-speed">--</span> km/h</p>
        <p><strong>Wind Direction:</strong> <span id="weather-wind-dir">--</span>Â°</p>
    </div>
    <div id="narrative-log"></div>

    <!-- Cheat Panel -->
    <div id="cheat-panel" style="display: none; position: absolute; top: 10px; left: 220px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-family: sans-serif; width: 250px;">
        <h3>Cheat Menu</h3>
        <button id="cheat-add-funds" title="Add 1000 funds to your faction">Add 1000 Funds</button><br>
        <button id="cheat-add-intel" title="Add 1000 intel to your faction">Add 1000 Intel</button><br>
        <button id="cheat-add-tech" title="Add 1000 tech to your faction">Add 1000 Tech</button><br>
        <hr>
        <h4>Create Threat</h4>
        <select id="cheat-threat-domain" title="Select the domain of the new threat"></select>
        <select id="cheat-threat-type" title="Select the type of the new threat"></select><br>
        <label for="cheat-threat-severity">Severity:</label>
        <input type="range" id="cheat-threat-severity" min="0.1" max="1.0" step="0.1" value="0.5" title="Set the severity of the new threat"><br>
        <button id="cheat-create-threat" title="Create a new threat with the specified properties">Create Threat</button>
        <hr>
        <h4>Selected Threat</h4>
        <button id="cheat-investigate-threat" title="Instantly investigate the selected threat" disabled>Instant Investigate</button><br>
        <button id="cheat-mitigate-threat" title="Instantly mitigate the selected threat" disabled>Instant Mitigate</button><br>
        <hr>
        <h4>Game Speed</h4>
        <input type="range" id="cheat-game-speed" min="0" max="5" step="0.5" value="1" title="Control the game speed"><br>
        <span id="game-speed-value">1x</span>
    </div>

    <button id="toggle-cheat-panel" style="position: absolute; top: 10px; right: 220px; width: 30px; height: 30px; background-color: #555; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">C</button>

    <!-- Build Panel -->
    <div id="build-panel" style="display: none; position: absolute; top: 150px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-family: sans-serif; width: 200px;">
        <h3>Build Menu</h3>
        <button id="build-base-button">Build Base (1000 Funds)</button><br>
        <button id="build-agent-button">Build Agent (500 Funds)</button><br>
        <button id="build-sensor-button">Build Sensor Tower (750 Funds)</button><br>
        <button id="build-research-outpost-button">Build Research Outpost (1200F, 500T)</button>
    </div>

    <!-- Research Panel -->
    <div id="research-panel" style="display: none; position: absolute; top: 150px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-family: sans-serif; width: 250px;">
        <h3>Research Menu</h3>
        <button id="research-advanced-agents-button">Advanced Agents (2000 Tech)</button><br>
        <button id="research-moon-program-button">Moon Program (50000 Tech)</button><br>
        <hr>
        <h4>Singularity Project</h4>
        <button id="research-singularity-1-button">Phase 1: AI Theory (75k Tech)</button><br>
        <button id="research-singularity-2-button" style="display: none;">Phase 2: AI Consciousness (150k Tech)</button><br>
        <button id="research-singularity-3-button" style="display: none;">Phase 3: Ascend (300k Tech)</button>
    </div>

    <script src="lib/three.min.js"></script>
    <script src="lib/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="src/faction.js"></script>
    <script src="src/region.js"></script>
    <script src="src/weather.js"></script>
    <script src="src/actions.js"></script>
    <script src="src/chronicle_rules.js"></script>
    <script src="src/narrative.js"></script>
    <script src="src/domain_logic.js"></script>
    <script src="src/threat.js"></script>
    <script src="src/plume.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/25.0.0/tween.umd.js"></script>
    <script src="src/building.js"></script>
    <script src="src/unit.js"></script>
    <script src="src/agent.js"></script>
    <script src="src/events.js"></script>
    <script src="src/world.js"></script>
    <script src="src/audio.js"></script>
    <script src="src/main.js"></script>
</body>
</html>
